<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –Ω–∞ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –°–æ—Ñ–∏—è</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        #header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14px;
            color: #bdc3c7;
        }
        
        #map {
            width: 100%;
            height: calc(100vh - 180px);
            cursor: crosshair;
        }
        
        #info {
            padding: 15px 20px;
            background-color: #ecf0f1;
            text-align: center;
            font-size: 14px;
            color: #34495e;
        }
        
        .search-container {
            padding: 15px 20px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        #addressInput {
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
            width: 400px;
            max-width: 100%;
        }
        
        #addressInput:focus {
            outline: none;
            border-color: #3498db;
        }
        
        #searchBtn {
            padding: 10px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        #searchBtn:hover {
            background-color: #2980b9;
        }
        
        .popup-content {
            padding: 10px;
            max-width: 300px;
        }
        
        .popup-content h3 {
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .popup-content p {
            margin: 5px 0;
            color: #555;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .popup-content .phones {
            color: #27ae60;
            font-weight: bold;
        }
        
        .popup-content .territory {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        
        .result-box {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 350px;
            z-index: 1000;
            display: none;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .result-box.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .result-box h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .result-box p {
            margin: 8px 0;
            color: #555;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .result-box .station-name {
            color: #3498db;
            font-weight: bold;
            font-size: 16px;
        }
        
        .result-box .distance {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .result-box .phones {
            color: #27ae60;
            font-weight: bold;
        }
        
        .result-box .territory {
            font-style: italic;
            color: #7f8c8d;
            font-size: 13px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .close-btn:hover {
            color: #2c3e50;
        }
        
        .error-message {
            color: #e74c3c;
            font-weight: bold;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üöî –ö–∞—Ä—Ç–∞ –Ω–∞ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –°–æ—Ñ–∏—è</h1>
        <p class="subtitle">–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –≤ —Ä–∞–π–æ–Ω–∞ –Ω–∞ –∫–æ–µ –†–£ —Å–µ –Ω–∞–º–∏—Ä–∞—Ç–µ</p>
    </div>
    
    <div class="search-container">
        <input type="text" id="addressInput" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä. –±—É–ª. –í–∏—Ç–æ—à–∞ 1, –∂.–∫. –ú–ª–∞–¥–æ—Å—Ç...)">
        <button id="searchBtn" onclick="searchAddress()">üîç –¢—ä—Ä—Å–∏</button>
    </div>
    
    <div id="info">
        –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –∏–ª–∏ –≤—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –æ–±—Å–ª—É–∂–≤–∞—â–æ—Ç–æ –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    </div>
    
    <div id="map"></div>
    
    <div id="resultBox" class="result-box">
        <button class="close-btn" onclick="closeResultBox()">√ó</button>
        <h3>–†–µ–∑—É–ª—Ç–∞—Ç</h3>
        <div id="resultContent"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –ü–æ–ª–∏—Ü–µ–π—Å–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –°–æ—Ñ–∏—è —Å –ø—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        const policeStations = [
            {
                name: "01 –†–£ - –°–î–í–†",
                lat: 42.67932459121964,
                lon: 23.35897604635238,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1113, –∂. –∫. \"–ì–µ–æ –ú–∏–ª–µ–≤\", –±—É–ª. \"–®–∏–ø—á–µ–Ω—Å–∫–∏ –ø—Ä–æ—Ö–æ–¥\" ‚Ññ 8",
                phones: "02/982 7166; 02/982 7167",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –°—Ä–µ–¥–µ—Ü, –°–ª–∞—Ç–∏–Ω–∞ –∏ –ò–∑–≥—Ä–µ–≤."
            },
            {
                name: "02 –†–£ - –°–î–í–†",
                lat: 42.70840889116461,
                lon: 23.32142258387964,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1202, —É–ª. \"–ö–Ω—è–∑ –ë–æ—Ä–∏—Å –Ü\" ‚Ññ 215",
                phones: "02/982 0820; 02/831 0107",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –°–µ—Ä–¥–∏–∫–∞, –ù–∞–¥–µ–∂–¥–∞ –∏ –ù–æ–≤–∏ –ò—Å–∫—ä—Ä."
            },
            {
                name: "03 –†–£ - –°–î–í–†",
                lat: 42.702637664665815,
                lon: 23.296368084117372,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1309, –∂. –∫. \"–ò–ª–∏–Ω–¥–µ–Ω\", —É–ª. \"–ò–Ω–¥–∂–µ –í–æ–π–≤–æ–¥–∞\" ‚Ññ 2",
                phones: "02/982 1260; 02/982 1290; 02/822 1875",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –í—ä–∑—Ä–∞–∂–¥–∞–Ω–µ, –ö—Ä–∞—Å–Ω–∞ –ø–æ–ª—è–Ω–∞ –∏ –ò–ª–∏–Ω–¥–µ–Ω."
            },
            {
                name: "04 –†–£ - –°–î–í–†",
                lat: 42.67972379358007,
                lon: 23.325799492311525,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1421, –∂. –∫. \"–õ–æ–∑–µ–Ω–µ—Ü\", —É–ª. \"–ö—Ä—É–º –ü–æ–ø–æ–≤\" ‚Ññ 57",
                phones: "02/982 4160; 02/982 3146; 02/866 2227",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ –¥–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞ - –¢—Ä–∏–∞–¥–∏—Ü–∞ –∏ –õ–æ–∑–µ–Ω–µ—Ü."
            },
            {
                name: "05 –†–£ - –°–î–í–†",
                lat: 42.695567438017285,
                lon: 23.340880091012394,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1504, —É–ª. \"–ú–∞—Ä–∏–Ω –î—Ä–∏–Ω–æ–≤\" ‚Ññ 4",
                phones: "02/982 5920; 02/982 5921",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –û–±–æ—Ä–∏—â–µ, –ü–æ–¥—É—è–Ω–µ –∏ –ö—Ä–µ–º–∏–∫–æ–≤—Ü–∏, –∫–∞–∫—Ç–æ –∏ —Å–µ–ª–∞—Ç–∞ –Ø–Ω–∞, –ñ–µ–ª—è–≤–∞, –î–æ–ª–Ω–∏ –ë–æ–≥—Ä–æ–≤, –ì–æ—Ä–Ω–∏ –ë–æ–≥—Ä–æ–≤ –∏ –≥—Ä. –ë—É—Ö–æ–≤–æ."
            },
            {
                name: "06 –†–£ - –°–î–í–†",
                lat: 42.67500432211623,
                lon: 23.279882470008868,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1618, –∂. –∫. \"–ö—Ä–∞—Å–Ω–æ —Å–µ–ª–æ\", –±—É–ª. \"–ë—Ä–∞—Ç—è –ë—ä–∫—Å—Ç–æ–Ω\" ‚Ññ 5",
                phones: "02/982 1760; 02/982 1761; 02/856 2914",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –ö—Ä–∞—Å–Ω–æ —Å–µ–ª–æ, –û–≤—á–∞ –∫—É–ø–µ–ª –∏ –í–∏—Ç–æ—à–∞, –∫–∞–∫—Ç–æ –∏ —Å–µ–ª–∞—Ç–∞: –í–ª–∞–¥–∞—è, –ú—ä—Ä—á–∞–µ–≤–æ –∏ –ú–∞–ª–æ –ë—É—á–∏–Ω–æ."
            },
            {
                name: "07 –†–£ - –°–î–í–†",
                lat: 42.63358377547459,
                lon: 23.367732948266692,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1700, –∂. –∫. \"–ú–ª–∞–¥–æ—Å—Ç\", –±—É–ª. \"–ê–ª–µ–∫—Å–∞–Ω–¥—ä—Ä –ú–∞–ª–∏–Ω–æ–≤\" ‚Ññ 1",
                phones: "02/982 8760; 02/862 6108",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ –¥–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: \"–ú–ª–∞–¥–æ—Å—Ç\" –∏ \"–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏\"."
            },
            {
                name: "08 –†–£ - –°–î–í–†",
                lat: 42.665603644002616,
                lon: 23.399016959948565,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1592, –∂. –∫. \"–î—Ä—É–∂–±–∞\", —É–ª. \"–ò–≤–∞–Ω –ê—Ä–∞–±–∞–¥–∂–∏—è—Ç–∞\" ‚Ññ 141",
                phones: "02/982 5310; 02/982 7310; 02/979 0786",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ –∫–≤–∞—Ä—Ç–∞–ª–∏—Ç–µ –î—Ä—É–∂–±–∞, –¶–∞—Ä–∏–≥—Ä–∞–¥—Å–∫–∏ –∫–æ–º–ø–ª–µ–∫—Å, –ê–±–¥–æ–≤–∏—Ü–∞, –î–∏–º–∏—Ç—ä—Ä –ú–∏–ª–µ–Ω–∫–æ–≤ –∏ –ë—É—Å–º–∞–Ω—Ü–∏, –¥–µ—Å–µ—Ç —Å–µ–ª–∞: –ü–∞–Ω—á–∞—Ä–µ–≤–æ, –ö–æ–∫–∞–ª—è–Ω–µ, –ü–∞—Å–∞—Ä–µ–ª, –õ–æ–∑–µ–Ω, –ì–µ—Ä–º–∞–Ω, –ö–∞–∑–∏—á–∞–Ω–µ, –ö—Ä–∏–≤–∏–Ω–∞, –ë–∏—Å—Ç—Ä–∏—Ü–∞, –ñ–µ–ª–µ–∑–Ω–∏—Ü–∞ –∏ –ü–ª–∞–Ω–∞ –∏ 53 –≤–∏–ª–Ω–∏ –∑–æ–Ω–∏."
            },
            {
                name: "09 –†–£ - –°–î–í–†",
                lat: 42.7207241692391,
                lon: 23.239486778838344,
                address: "–≥—Ä. –°–æ—Ñ–∏—è, –ø. –∫–æ–¥ 1359, –∂. –∫. \"–õ—é–ª–∏–Ω –ÜV\" –±–ª. 464, –≤—Ö. –í",
                phones: "02/982 5600; 02/982 5601; 02/824 3655",
                territory: "–û–±—Å–ª—É–∂–≤–∞–Ω–∞—Ç–∞ —Ç–µ—Ä–∏—Ç–æ—Ä–∏—è –æ–±—Ö–≤–∞—â–∞ —Ç—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç–æ–ª–∏—á–Ω–∏ —Ä–∞–π–æ–Ω–∞: –õ—é–ª–∏–Ω, –í—Ä—ä–±–Ω–∏—Ü–∞ –∏ –ë–∞–Ω–∫—è."
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
        const map = L.map('map').setView([42.6977, 23.3219], 12);

        // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ OpenStreetMap —Å–ª–æ—è
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // –ò–∫–æ–Ω–∞ –∑–∞ –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        const policeIcon = L.icon({
            iconUrl: 'data:image/svg+xml;utf8,' + encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32">
                    <circle cx="12" cy="12" r="10" fill="#3498db" stroke="white" stroke-width="2"/>
                    <path d="M12 3 L14 8 L19 8 L15 11 L17 16 L12 13 L7 16 L9 11 L5 8 L10 8 Z" fill="white"/>
                </svg>
            `),
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, -16]
        });

        // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏ –∑–∞ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏—Ç–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        policeStations.forEach(station => {
            const marker = L.marker([station.lat, station.lon], { icon: policeIcon }).addTo(map);
            marker.bindPopup(`
                <div class="popup-content">
                    <h3>${station.name}</h3>
                    <p><strong>–ê–¥—Ä–µ—Å:</strong><br>${station.address}</p>
                    <p class="phones"><strong>–î–µ–∂—É—Ä–Ω–∞ —á–∞—Å—Ç:</strong><br>${station.phones}</p>
                    <p class="territory">${station.territory}</p>
                </div>
            `);
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ (Haversine —Ñ–æ—Ä–º—É–ª–∞)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // –†–∞–¥–∏—É—Å –Ω–∞ –ó–µ–º—è—Ç–∞ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∏
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;
            return distance;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–∞–π-–±–ª–∏–∑–∫–æ—Ç–æ –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        function findNearestPoliceStation(lat, lon) {
            let nearest = null;
            let minDistance = Infinity;

            policeStations.forEach(station => {
                const distance = calculateDistance(lat, lon, station.lat, station.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = station;
                }
            });

            return { station: nearest, distance: minDistance };
        }

        // –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –∑–∞ –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–ª–∏–∫–Ω–∞—Ç–æ—Ç–æ/—Ç—ä—Ä—Å–µ–Ω–æ –º—è—Å—Ç–æ
        let clickMarker = null;

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
        function showResult(lat, lon, source = 'click') {
            // –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –ø—Ä–µ–¥–∏—à–Ω–∏—è –º–∞—Ä–∫–µ—Ä
            if (clickMarker) {
                map.removeLayer(clickMarker);
            }

            // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ –º–∞—Ä–∫–µ—Ä
            clickMarker = L.marker([lat, lon], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;utf8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32">
                            <circle cx="12" cy="12" r="8" fill="#e74c3c" stroke="white" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" fill="white"/>
                        </svg>
                    `),
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                })
            }).addTo(map);

            // –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
            map.setView([lat, lon], 14);

            // –ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–∞–π-–±–ª–∏–∑–∫–æ—Ç–æ –†–£
            const result = findNearestPoliceStation(lat, lon);
            const distance = result.distance;
            const station = result.station;

            // –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ—Ç–æ
            let distanceText;
            if (distance < 1) {
                distanceText = `${Math.round(distance * 1000)} –º–µ—Ç—Ä–∞`;
            } else {
                distanceText = `${distance.toFixed(2)} –∫–∏–ª–æ–º–µ—Ç—Ä–∞`;
            }

            // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
            const resultContent = `
                <p><strong>–ü–æ—Å–æ—á–µ–Ω–∞ –ª–æ–∫–∞—Ü–∏—è:</strong><br>
                ${lat.toFixed(6)}, ${lon.toFixed(6)}</p>
                
                <p class="station-name">${station.name}</p>
                
                <p><strong>–ê–¥—Ä–µ—Å –Ω–∞ –†–£:</strong><br>
                ${station.address}</p>
                
                <p class="phones"><strong>–î–µ–∂—É—Ä–Ω–∞ —á–∞—Å—Ç:</strong><br>
                ${station.phones}</p>
                
                <p class="distance"><strong>–†–∞–∑—Å—Ç–æ—è–Ω–∏–µ –¥–æ –†–£:</strong><br>
                ${distanceText}</p>
                
                <p class="territory">${station.territory}</p>
            `;

            document.getElementById('resultContent').innerHTML = resultContent;
            document.getElementById('resultBox').classList.add('show');

            // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –ª–∏–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞—Ç–∞ –∏ –†–£
            if (window.currentLine) {
                map.removeLayer(window.currentLine);
            }
            window.currentLine = L.polyline([[lat, lon], [station.lat, station.lon]], {
                color: '#3498db',
                weight: 2,
                opacity: 0.7,
                dashArray: '5, 10'
            }).addTo(map);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∫–ª–∏–∫–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
        map.on('click', function(e) {
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;
            showResult(lat, lon, 'click');
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ –∞–¥—Ä–µ—Å
        async function searchAddress() {
            const address = document.getElementById('addressInput').value.trim();
            
            if (!address) {
                alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å');
                return;
            }

            // –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ Nominatim API –∑–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–∞–Ω–µ
            const query = `${address}, –°–æ—Ñ–∏—è, –ë—ä–ª–≥–∞—Ä–∏—è`;
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    showResult(lat, lon, 'search');
                } else {
                    document.getElementById('resultContent').innerHTML = 
                        '<div class="error-message">–ê–¥—Ä–µ—Å—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω. –ú–æ–ª—è, –æ–ø–∏—Ç–∞–π—Ç–µ —Å –¥—Ä—É–≥ –∞–¥—Ä–µ—Å –∏–ª–∏ –∫–ª–∏–∫–Ω–µ—Ç–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞.</div>';
                    document.getElementById('resultBox').classList.add('show');
                }
            } catch (error) {
                document.getElementById('resultContent').innerHTML = 
                    '<div class="error-message">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ. –ú–æ–ª—è, –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.</div>';
                document.getElementById('resultBox').classList.add('show');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Enter –≤ –ø–æ–ª–µ—Ç–æ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ
        document.getElementById('addressInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchAddress();
            }
        });

        function closeResultBox() {
            document.getElementById('resultBox').classList.remove('show');
            if (clickMarker) {
                map.removeLayer(clickMarker);
                clickMarker = null;
            }
            if (window.currentLine) {
                map.removeLayer(window.currentLine);
                window.currentLine = null;
            }
        }
    </script>
</body>
</html>
